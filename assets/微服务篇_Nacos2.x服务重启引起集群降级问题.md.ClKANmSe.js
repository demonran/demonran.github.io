import{_ as a,c as e,o as t,a1 as o}from"./chunks/framework.rLRl8Q3O.js";const m=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"微服务篇/Nacos2.x服务重启引起集群降级问题.md","filePath":"微服务篇/Nacos2.x服务重启引起集群降级问题.md","lastUpdated":1717060235000}'),r={name:"微服务篇/Nacos2.x服务重启引起集群降级问题.md"},s=o('<h3 id="问题发现" tabindex="-1">问题发现 <a class="header-anchor" href="#问题发现" aria-label="Permalink to &quot;问题发现&quot;">​</a></h3><p>服务启动失败，看日志发现如下报错： Nacos cluster is running with 1.X mode, can&#39;t accept gRPC request temporarily. Please check the server status or close Double write to force open 2.0 mode</p><h3 id="问题分析" tabindex="-1">问题分析 <a class="header-anchor" href="#问题分析" aria-label="Permalink to &quot;问题分析&quot;">​</a></h3><ol><li>nacos采用的集群方式部署， 突然有一台机器出现了异常，将nacos集群进行重启， 重启后nacos启动正常，</li></ol><ul><li>查看logs/naming-server.log 发现如下INFO日志：upgrade check result false</li><li>查看 data/upgrade.state, 显示upgraded=false</li></ul><p>由此推断服务启动后集群被降级到1.x版本。导致客户端和服务端版本不一致。</p><h3 id="问题原因" tabindex="-1">问题原因 <a class="header-anchor" href="#问题原因" aria-label="Permalink to &quot;问题原因&quot;">​</a></h3><p>由于同时重启nacos集群</p><h3 id="问题解决" tabindex="-1">问题解决 <a class="header-anchor" href="#问题解决" aria-label="Permalink to &quot;问题解决&quot;">​</a></h3><p>curl -X PUT &#39;localhost:8848/nacos/v1/ns/operator/switches?entry=doubleWriteEnabled&amp;value=false&#39;</p><p>关闭后可以从logs/naming-server.log日志中观察到Disable Double write, stop and clean v1.x cache and features字样。说明关闭双写。</p>',11),l=[s];function c(n,i,_,d,h,p){return t(),e("div",null,l)}const f=a(r,[["render",c]]);export{m as __pageData,f as default};
