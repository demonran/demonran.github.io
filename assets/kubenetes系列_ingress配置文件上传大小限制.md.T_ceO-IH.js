import{_ as n,c as s,o as a,a1 as e}from"./chunks/framework.rLRl8Q3O.js";const h=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"kubenetes系列/ingress配置文件上传大小限制.md","filePath":"kubenetes系列/ingress配置文件上传大小限制.md"}'),i={name:"kubenetes系列/ingress配置文件上传大小限制.md"},p=e(`<h3 id="问题原因" tabindex="-1">问题原因 <a class="header-anchor" href="#问题原因" aria-label="Permalink to &quot;问题原因&quot;">​</a></h3><p>在通过ingress-nginx访问k8s服务，并执行文件上传等逻辑时，如果文件过大，会出现413 Request Entity Too Large。</p><h3 id="原因分析" tabindex="-1">原因分析 <a class="header-anchor" href="#原因分析" aria-label="Permalink to &quot;原因分析&quot;">​</a></h3><p>这是因为nginx的默认的request body大小为1M, 我们使用ingress访问后端服务，ingress的实现使用的是nginx-ingress-controller, 所以就会有文件上传大小配置。 我们知道，nginx可以在nginx的配置中加client_max_body_size 参数来修改该默认值。 client_max_body_size 支持 http 、 server 、 location</p><p>但是我们使用ingress时nginx配置是k8s生成的， 我们要修改该配置执行通过k8s的相关方式来进行修改。</p><h3 id="方法" tabindex="-1">方法 <a class="header-anchor" href="#方法" aria-label="Permalink to &quot;方法&quot;">​</a></h3><h5 id="全局修改" tabindex="-1">全局修改 <a class="header-anchor" href="#全局修改" aria-label="Permalink to &quot;全局修改&quot;">​</a></h5><ol><li><p>查找configmap 查看nginx-ingress-controller的启动配置，找到<code> --configmap=$(POD_NAMESPACE)/nginx-configuration</code> 这个配置。 可以看到读取了nginx-configuration这个configmap。</p></li><li><p>增加configmap数据data.</p></li></ol><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kind: ConfigMap</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: nginx-configuration</span></span>
<span class="line"><span>  namespace: ingress-nginx</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    app: ingress-nginx</span></span>
<span class="line"><span>data:</span></span>
<span class="line"><span>    proxy-body-size: 50m</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="单个应用修改" tabindex="-1">单个应用修改 <a class="header-anchor" href="#单个应用修改" aria-label="Permalink to &quot;单个应用修改&quot;">​</a></h5><p>在对应的应用的ingress增加annotation</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kind: Ingress</span></span>
<span class="line"><span>apiVersion: networking.k8s.io/v1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: infra-gateway-ingress</span></span>
<span class="line"><span>  namespace: default</span></span>
<span class="line"><span>  annotations:</span></span>
<span class="line"><span>    nginx.ingress.kubernetes.io/proxy-body-size: &#39;50m&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参考文档： <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size" target="_blank" rel="noreferrer">https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size</a><a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#proxy-body-size" target="_blank" rel="noreferrer">https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#proxy-body-size</a></p>`,13),r=[p];function l(t,o,c,d,b,g){return a(),s("div",null,r)}const m=n(i,[["render",l]]);export{h as __pageData,m as default};
