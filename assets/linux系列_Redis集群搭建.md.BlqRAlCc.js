import{_ as s,c as n,o as a,a1 as e}from"./chunks/framework.rLRl8Q3O.js";const h=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"linux系列/Redis集群搭建.md","filePath":"linux系列/Redis集群搭建.md","lastUpdated":1733724441000}'),p={name:"linux系列/Redis集群搭建.md"},l=e(`<p>Redis高可用分两种： 哨兵模式+主从复制和集群模式</p><h4 id="哨兵模式-主从复制" tabindex="-1">哨兵模式+主从复制： <a class="header-anchor" href="#哨兵模式-主从复制" aria-label="Permalink to &quot;哨兵模式+主从复制：&quot;">​</a></h4><p>哨兵模式是一主多从，对于小型项目来说已经可以满足需求了， 但是由于Redis单线程应用，在单节点下理论上可以达到10W并发，对于大型互联网公司远远不够</p><h4 id="集群模式" tabindex="-1">集群模式 <a class="header-anchor" href="#集群模式" aria-label="Permalink to &quot;集群模式&quot;">​</a></h4><p>Redis 3.0后推出了集群模式，实现多主多从。</p><p>搭建主要是redis配置</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 修改为后台启动</span></span>
<span class="line"><span>daemonize yes</span></span>
<span class="line"><span># 修改端口号</span></span>
<span class="line"><span>port 8001</span></span>
<span class="line"><span># 指定数据文件存储位置</span></span>
<span class="line"><span>dir /usr/local/redis-app/8001/</span></span>
<span class="line"><span># 开启集群模式</span></span>
<span class="line"><span>cluster-enabled yes</span></span>
<span class="line"><span># 集群节点信息文件配置</span></span>
<span class="line"><span>cluster-config-file nodes-8001.conf</span></span>
<span class="line"><span># 集群节点超时间</span></span>
<span class="line"><span>cluster-node-timeout 15000</span></span>
<span class="line"><span># 去掉bind绑定地址</span></span>
<span class="line"><span># bind 127.0.0.1 -::1 (这里没写错就是家#注释掉bind配置)</span></span>
<span class="line"><span># 关闭保护模式</span></span>
<span class="line"><span>protected-mode no</span></span>
<span class="line"><span># 开启aof模式持久化</span></span>
<span class="line"><span>appendonly yes</span></span>
<span class="line"><span># 设置连接Redis需要密码123（选配）</span></span>
<span class="line"><span>requirepass 123456</span></span>
<span class="line"><span># 设置Redis节点与节点之间访问需要密码123（选配）</span></span>
<span class="line"><span>masterauth 123456</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>集群创建</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>./bin/redis-cli -a 123456 --cluster create --cluster-replicas 1 192.168.100.101:8001 192.168.100.101:8002 192.168.100.102:8003 192.168.100.102:8004 192.168.100.103:8005 192.168.100.103:8006</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>集群查看</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 查看集群信息</span></span>
<span class="line"><span>CLUSTER INFO</span></span>
<span class="line"><span># 查看集群节点</span></span>
<span class="line"><span>CLUSTER NODES</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>添加节点</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 使用如下命令即可添加节点将一个新的节点添加到集群中</span></span>
<span class="line"><span># -a 密码认证(没有密码不用带此参数)</span></span>
<span class="line"><span># --cluster add-node 添加节点 新节点IP:新节点端口 任意存活节点IP:任意存活节点端口</span></span>
<span class="line"><span>./bin/redis-cli -a 123456 --cluster add-node 192.168.100.104:8007 192.168.100.101:8001</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>槽位迁移</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 使用如下命令将其它主节点的分片迁移到当前节点中</span></span>
<span class="line"><span># -a 密码认证(没有密码不用带此参数)</span></span>
<span class="line"><span># --cluster reshard 槽位迁移 从节点IP:节点端口，中迁移槽位到当前节点中</span></span>
<span class="line"><span>./bin/redis-cli --cluster reshard 192.168.100.101:8002</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>从节点添加</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 使用如下命令即可添加节点将一个新的节点添加到集群中</span></span>
<span class="line"><span># -a 密码认证(没有密码不用带此参数)</span></span>
<span class="line"><span># --cluster add-node 添加节点 新节点IP:新节点端口 任意存活节点IP:任意存活节点端口</span></span>
<span class="line"><span>./bin/redis-cli -a 123456 --cluster add-node 192.168.100.104:8008 192.168.100.101:8001</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 连接需设为从节点的Redis服务</span></span>
<span class="line"><span>./bin/redis-cli -a 123456 -p 8008</span></span>
<span class="line"><span># 将当前节点分配为 8cf44439390dc9412813ad27c43858a6bb53365c 的从节点</span></span>
<span class="line"><span>CLUSTER REPLICATE 8cf44439390dc9412813ad27c43858a6bb53365c</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>删除主节点</p><blockquote><p>主节点删除就那么首先需要对槽进行迁移，如当前需要移除8007节点，那么首先需要把8007的节点槽位移动到别的节点中，才能删除</p></blockquote><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 执行如下命令删除节点</span></span>
<span class="line"><span># -a 密码认证(没有密码不用带此参数)</span></span>
<span class="line"><span># --cluster del-node 连接任意一个存活的节点IP:连接任意一个存活的节点端口 要删除节点ID </span></span>
<span class="line"><span>./bin/redis-cli -a 123456 --cluster del-node 192.168.100.101:8002 8cf44439390dc9412813ad27c43858a6bb53365c</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>重新分配槽位</p><blockquote><p>重新分配槽位慎用！！！，该功能可以让着集群的槽位重新平均分配但是由于涉及到槽位大量迁移会导致整个Redis阻塞停止处理客户端的请求</p></blockquote><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># -a 密码认证(没有密码不用带此参数)</span></span>
<span class="line"><span># --cluster rebalance 重新分配集群中的槽位</span></span>
<span class="line"><span>./bin/redis-cli -a 123456 --cluster rebalance 192.168.100.101:8002</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>`,23),i=[l];function c(r,d,b,t,u,o){return a(),n("div",null,i)}const v=s(p,[["render",c]]);export{h as __pageData,v as default};
